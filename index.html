<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INCubation</title>
    <link rel="icon" href="img/icon.png" type="">
    <link rel="stylesheet" href="index.css">
    <script src="script.js"></script>
</head>
<body>
    <!-- User Info (top right) -->
    <div class="user-info" id="user-info" style="display: none;">
        <span class="user-email" id="user-email">Loading...</span>
        <button class="logout-btn" id="logout-btn">Logout</button>
    </div>

    <!-- Top Navigation -->
    <div class="top-nav">
        <a href="#" class="home-link">Home</a>
    </div>

    <!-- Logo - Centered -->
    <div class="logo">
        <img src="img/game_logo.png" alt="INCubation">
    </div>

    <!-- Menu Container - Bottom Center -->
    <div class="menu-container">
        <button class="menu-button primary" onclick="window.location.href='game.html'">New game</button>
        <button class="menu-button primary" onclick="window.location.href='settings.html'">Settings</button>
    </div>

    <!-- Bottom Left Stats -->
    <div class="bottom-stats">
        <div class="stat-badge" id="credits-stat">0 CR</div>
        <div class="stat-badge" id="xp-stat">0 XP</div>
    </div>

    <!-- Bottom Right Icons -->
    <div class="bottom-icons">
        <button class="icon-button" onclick="window.location.href='leaderboard.html'" title="leaderboard">
            <svg viewBox="0 0 24 24">
                <path d="M3 3v18h18V3H3zm16 16H5V5h14v14zm-3-3h2v-6h-2v6zm-4 0h2V8h-2v8zm-4 0h2v-4H8v4z"/>
            </svg>
        </button>
        <button class="icon-button" onclick="window.location.href='collectibles.html'" title="collectibles">
            <svg viewBox="0 0 24 24">
                <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-9.83-3.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4h-.01l-1.1 2-2.76 5H8.53l-.13-.27L6.16 6l-.95-2-.94-2H1v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.13 0-.25-.11-.25-.25z"/>
            </svg>
        </button>
    </div>

    <!-- Firebase Integration -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        const firebaseConfig = {
        apiKey: "AIzaSyAQB89Td3YGWMlokZ4C6oPpn2j91y6uQsM",
        authDomain: "iplogininc.firebaseapp.com",
        projectId: "iplogininc",
        storageBucket: "iplogininc.firebasestorage.app",
        messagingSenderId: "600493251801",
        appId: "1:600493251801:web:22adeb0f992cfb7fbd32c8",
        measurementId: "G-6YQ5RH84N9"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Check authentication and load stats
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                // Not logged in, redirect to login page
                window.location.href = 'login.html';
                return;
            }

            // Show user info
            document.getElementById('user-info').style.display = 'flex';
            document.getElementById('user-email').textContent = user.email;

            // Load stats from Firestore
            try {
                const userRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    const credits = userData.credits || 0;
                    const xp = userData.xp || 0;

                    // Update display
                    document.getElementById('credits-stat').textContent = `${credits} CR`;
                    document.getElementById('xp-stat').textContent = `${xp} XP`;

                    // Update localStorage
                    localStorage.setItem('gameCredits', credits);
                    localStorage.setItem('gameXP', xp);
                    localStorage.setItem('userId', user.uid);
                    localStorage.setItem('userEmail', user.email);
                }
            } catch (error) {
                console.error('Error loading user stats:', error);
            }
        });

        // Logout handler
        document.getElementById('logout-btn').addEventListener('click', async () => {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await signOut(auth);
                    localStorage.clear();
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Logout error:', error);
                    alert('Error logging out. Please try again.');
                }
            }
        });
    </script>
</body>
</html>